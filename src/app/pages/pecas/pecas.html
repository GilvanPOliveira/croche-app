<section class="pecas">
  <!-- LISTAGEM NORMAL -->
  <div class="container" *ngIf="!erro && !carregando && pecasFiltradas.length > 0">

    <header class="topo-pecas">
      <div class="titulo">
        <h1>{{ categoriaSelecionada || 'Todas as Peças' }}</h1>

        <small>
          Exibindo
          <strong>{{ pecasFiltradas.length }}</strong>
          {{ pecasFiltradas.length === 1 ? 'peça' : 'peças' }}

          <ng-container *ngIf="categoriaSelecionada">
            na categoria <strong>{{ categoriaSelecionada }}</strong>
          </ng-container>

          <ng-container *ngIf="tipoSelecionado">
            / tipo <strong>{{ tipoSelecionado }}</strong>
          </ng-container>
        </small>
      </div>

      <div class="acoes">
        <button
          class="btn-outline"
          *ngIf="categoriaSelecionada || tipoSelecionado"
          (click)="limparFiltro()"
        >
          Limpar filtros
        </button>
      </div>
    </header>

    <!-- FILTROS PRINCIPAIS -->
    <nav class="filtros">
      <button
        class="chip"
        [class.active]="!categoriaSelecionada"
        (click)="selecionarCategoria(null)"
      >
        Todas
      </button>

      <button
        class="chip"
        *ngFor="let c of categorias"
        [class.active]="isAtiva(c)"
        (click)="selecionarCategoria(c)"
      >
        {{ c }}
      </button>
    </nav>

    <!-- SUBFILTRO POR TIPO -->
    <nav *ngIf="tiposDisponiveis.length > 0" class="subfiltros">
      <button
        class="chip"
        *ngFor="let t of tiposDisponiveis"
        [class.active]="isTipoAtivo(t)"
        (click)="selecionarTipo(t)"
      >
        {{ t }}
      </button>
    </nav>

    <!-- GRID DE PEÇAS -->
    <div class="grid-pecas">
      <article
        *ngFor="let peca of pecasFiltradas"
        class="peca"
        tabindex="0"
        role="button"
        aria-label="Abrir detalhes de {{ peca.nome }}"
        (click)="verDetalhes(peca)"
        (keyup.enter)="verDetalhes(peca)"
      >
        <div class="thumb">
          <img
            [src]="peca.imagem"
            [alt]="peca.nome"
            loading="lazy"
            decoding="async"
            (error)="peca.imagem = '/assets/image/imagem-404.png'"
          />
          <span class="badge">{{ peca.nome }}</span>
        </div>
      </article>
    </div>
  </div>

  <!-- NENHUMA PEÇA ENCONTRADA (filtro muito restrito) -->
  <div class="container vazio" *ngIf="!erro && !carregando && pecas.length > 0 && pecasFiltradas.length === 0">
    <h2>Nenhuma peça encontrada</h2>
    <p>
      Tente remover alguns filtros ou escolher outra categoria/tipo.
    </p>
    <button class="btn-outline" (click)="limparFiltro()">
      Ver todas as peças
    </button>
  </div>

  <!-- LOADING -->
  <div class="container loading" *ngIf="carregando && !erro">
    <div class="loading-grid">
      <div class="skeleton card" *ngFor="let i of [].constructor(6)"></div>
    </div>
  </div>

  <!-- ERRO -->
  <div class="container erro" *ngIf="erro">
    <p>Não foi possível carregar as peças no momento.</p>
    <a routerLink="/" class="btn-outline btn-voltar">Voltar ao início</a>
  </div>
</section>
