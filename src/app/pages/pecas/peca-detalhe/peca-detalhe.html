<section class="peca-detalhe" *ngIf="!carregando && !erro && peca as p">
  <div class="container">

    <nav class="navegacao-topo">
      <button class="btn-outline" (click)="irParaAnterior()" [disabled]="indiceAtual === 0">
        <i class="fa-solid fa-chevron-left"></i> Anterior
      </button>

      <button class="btn" (click)="voltar()">
        Ver todas as peças
      </button>

      <button class="btn-outline" (click)="irParaProxima()" [disabled]="indiceAtual === pecasLista.length - 1">
        Próxima <i class="fa-solid fa-chevron-right"></i>
      </button>
    </nav>

    <article class="peca-card">
      <div class="peca-conteudo">

        <figure class="peca-imagem">
          <img [src]="p.imagem" [alt]="'Imagem da peça ' + p.nome" class="peca-img" (error)="onImageError($event)" />
        </figure>

        <div class="peca-info card-infos">

          <h1>{{ p.nome }}</h1>

          <p class="descricao" *ngIf="p.descricao">{{ p.descricao }}</p>

          <div *ngIf="p.linhas.length || p.agulha">
            <h2 class="subtitulo">Materiais e ferramentas</h2>

            <ul>
              <li *ngFor="let linha of p.linhas">
                <strong>Linha:</strong> {{ linha }}
              </li>

              <li *ngIf="p.agulha">
                <strong>Agulha:</strong> {{ p.agulha }}
              </li>
            </ul>
          </div>

          <div *ngIf="p.tamanhos && (p.tamanhos | keyvalue).length">

            <h2 class="subtitulo">Tamanhos disponíveis</h2>

            <div class="info-tamanho">
              <p><strong>Tamanho selecionado:</strong> {{ tamanhoSelecionado }}</p>
            </div>

            <table class="tabela-tamanhos">
              <thead>
                <tr>
                  <th>Tamanho</th>
                  <th>Medidas</th>
                  <th>Preço</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let t of (p.tamanhos | keyvalue: ordenarTamanhos)" [class.selecionado]="t.key === tamanhoSelecionado" (click)="selecionarTamanho(t.key)">
                  <td>{{ t.key }}</td>

                  <td>
                    <ng-container *ngIf="t.value.medidas; else semMedidas">
                      <ng-container *ngFor="let m of (t.value.medidas | keyvalue); let last = last">
                        {{ m.key }}: {{ m.value }}<span *ngIf="!last">, </span>
                      </ng-container>
                    </ng-container>

                    <ng-template #semMedidas>—</ng-template>
                  </td>

                  <td>{{ t.value.preco || 'Sob consulta' }}</td>

                </tr>
              </tbody>
            </table>
          </div>

          <p *ngIf="p.observacoes" class="obs">
            <strong>Observações:</strong> {{ p.observacoes }}
          </p>

          <div class="acoes">
            <button class="btn" (click)="adicionarEncomenda()">
              <i class="fa-solid fa-bag-shopping"></i>
              Encomendar
            </button>

            <button class="btn-outline" (click)="abrirCustomizacao()">
              <i class="fa-solid fa-pen-ruler"></i>
              Customizar
            </button>
          </div>

        </div>
      </div>
    </article>

  </div>
</section>

<section *ngIf="carregando" class="loading-detalhe">
  <div class="container">
    <p>Carregando peça...</p>
  </div>
</section>

<section *ngIf="erro" class="erro-detalhe">
  <div class="container">
    <h2>Peça não encontrada</h2>
    <p>A peça solicitada não foi localizada.</p>
    <a routerLink="/pecas" class="btn-voltar">Voltar às peças</a>
  </div>
</section>